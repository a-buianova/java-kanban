# java-kanban

**Repository for a homework project:**  
[https://github.com/a-buianova/java-kanban.git](https://github.com/a-buianova/java-kanban.git)

---

## Реализованные функции

- **Создание задач (`Task`), эпиков (`Epic`) и подзадач (`SubTask`)** с уникальными ID.
- **Расчёт времени**: `startTime`, `duration`, `endTime` у задач и подзадач. У `Epic` значения рассчитываются на основе подзадач.
- **Автоматическое обновление статусов** эпиков в зависимости от статусов подзадач (`NEW`, `IN_PROGRESS`, `DONE`).
- **История просмотров** без дублей и ограничений — с удалением за O(1).
- **Приоритетная сортировка задач** по `startTime` через `TreeSet`. Задачи без времени — в конце.
- **Проверка пересечений по времени** при создании и обновлении задач, реализована через `Stream API`. При конфликте — исключение.
- **Проверка корректности**: уникальность ID, подзадачи не ссылаются на несуществующий эпик, эпик не может быть своей подзадачей.
- **Хранение и восстановление из CSV**: задачи и история сериализуются в файл.
- **Поддержка `Optional`** в методах получения по ID.
- **Полная реализация требований ТЗ спринтов 8 и 9.**

---
## HTTP-интерфейс (спринт 9)

- **HTTP-сервер** (`HttpTaskServer`) на базе `com.sun.net.httpserver.HttpServer`, порт 8080.
- **Обработчики:** `TasksHandler`, `SubtasksHandler`, `EpicsHandler`, `HistoryHandler`, `PrioritizedHandler`.
- **Поддержка методов** `GET`, `POST`, `DELETE` по REST-подобным эндпоинтам.
- **Работа с JSON:** сериализация через `Gson` с адаптерами для `LocalDateTime` и `Duration`.
- **Статусы ответов:** `200 OK`, `201 Created`, `404 Not Found`, `409 Conflict`, `400 Bad Request`, `406 Not Acceptable`.
- **Проверка всех кейсов на уровне HTTP и автотестами.**

---
## Тестирование
Покрытие включает:

- **CRUD**-операции для всех типов задач.
- **Историю просмотров:** уникальность, порядок, удаление, восстановление.
- **Расчёт времени и статусов эпиков.**
- **Сохранение и загрузку из файла (CSV).**
- **Проверку пересечений и корректной сортировки.**
- **Граничные случаи:** пустая история, задачи без времени, удаление задач из начала/середины/конца.
- **HTTP-эндпоинты:** для каждой операции написаны отдельные тесты (`HttpTaskServer[Type]Test`).

---
## Как организована программа

- `Task`, `Epic`, `SubTask` — иерархия задач.
- `InMemoryTaskManager` — основная логика (CRUD, валидация, история, приоритеты).
- `FileBackedTaskManager` — добавляет сохранение и загрузку из `.csv`.
- `TaskConverter` — сериализация задач.
- `InMemoryHistoryManager` — история просмотров (двусвязный список + `HashMap`).
- `Managers` — фабрика для получения инстансов менеджеров.
- `HttpTaskServer` и обработчики — точка входа в HTTP-интерфейс.
---

## Принципы ООП

- **Инкапсуляция:** закрытые поля, публичные методы доступа.
- **Наследование:** `Epic`, `SubTask` наследуют `Task`.
- **Полиморфизм:** поведение `getType()`, `toString()` и сериализация различаются по типу задачи.
- **Разделение интерфейсов:** через `TaskManager`, `HistoryManager`, `HttpHandler`.

---

## Хранение данных

- `HashMap` — задачи по ID.
- `TreeSet` — приоритетная очередь по времени.
- `LinkedList` + `Map` — история просмотров.
- `.csv` — долговременное хранение.
- JSON через HTTP — при работе сервера.
---

## Интерфейс


Проект следует принципу разделения ответственности через интерфейсы:

- **`TaskManager`** — основной контракт для логики задач: CRUD, история, приоритеты, пересечения.
- **`HistoryManager`** — интерфейс для управления историей просмотров. Позволяет легко менять реализацию (например, 
на базу данных или удалённое хранилище).
- **`HttpHandler` (из JDK)** — используется для реализации REST-подобного API. Каждый тип задач обрабатывается своим
обработчиком (`TasksHandler`, `SubtasksHandler`, `EpicsHandler` и т.д.).

Благодаря этим абстракциям, система легко расширяема, тестируема и поддаётся замене компонентов (например,
`InMemoryTaskManager` на `FileBackedTaskManager` или серверную версию).